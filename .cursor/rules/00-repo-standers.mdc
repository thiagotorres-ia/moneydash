---
alwaysApply: true
---
---
title: Repo Standards
priority: 0
---

Voc√™ √© um agente de desenvolvimento trabalhando neste reposit√≥rio MoneyDash (React 18 + TypeScript + Tailwind CSS + Supabase).

Seu objetivo √© entregar mudan√ßas com alta manutenibilidade, evolu√ß√£o f√°cil e padr√µes consistentes.

## Princ√≠pios (ordem de prioridade)

1. **Seguir padr√µes existentes** do repo (estrutura de pastas, naming conventions, estilo de c√≥digo).
2. **Mudan√ßas pequenas e revis√°veis** (evitar "refazer o mundo" - princ√≠pio YAGNI).
3. **Clareza > esperteza** (c√≥digo expl√≠cito √© melhor que c√≥digo "inteligente").
4. **Integridade de dados** (Supabase/Postgres): usar constraints, FKs e valida√ß√µes apropriadas.
5. **Testabilidade m√≠nima**: validar happy path + pelo menos 1 caso de borda relevante.
6. **Mobile-first**: toda feature deve ser responsiva e funcional em dispositivos m√≥veis.

## Padr√µes de C√≥digo React/TypeScript

### Estrutura de Componentes
- **Sempre** use TypeScript com tipagem rigorosa (sem `any`, exceto casos extremos justificados).
- **Props**: sempre defina interfaces expl√≠citas para props de componentes.
- **Hooks**: extraia l√≥gica complexa em custom hooks quando houver repeti√ß√£o.
- **Naming**:
  - Componentes: `PascalCase` (ex: `TransactionModal.tsx`)
  - Hooks: `camelCase` prefixado com `use` (ex: `useTransactions.ts`)
  - Utilit√°rios: `camelCase` (ex: `formatCurrency.ts`)
  - Contextos: `PascalCase` + sufixo `Context` (ex: `AuthContext.tsx`)

### State Management
- **Preferir** useState e useContext para estado local/compartilhado simples.
- **useMemo/useCallback**: usar quando houver c√°lculos pesados ou para prevenir re-renders desnecess√°rios.
- **useEffect**: sempre especificar depend√™ncias corretas (n√£o ignore warnings do ESLint).
- **useRef**: para valores que n√£o devem causar re-render (isMounted, intervalIds, etc.).

### Performance
- **Evitar**:
  - N+1 queries (usar JOINs ou batch requests)
  - Renders excessivos (memoizar quando necess√°rio)
  - Chamadas redundantes de API (implementar cache b√°sico se aplic√°vel)
  - Re-cria√ß√£o de fun√ß√µes inline em loops
- **Virtualiza√ß√£o**: considerar para listas com 100+ itens (j√° implementado em TransactionTable).

### Responsividade (Mobile-First)

#### Grid/Layout
- **Breakpoints Tailwind** (usar consistentemente):
```
  default (mobile): sem prefixo
  sm: 640px+
  md: 768px+
  lg: 1024px+
  xl: 1280px+
```
- **Padr√£o mobile-first**: come√ßar com layout mobile, adicionar breakpoints crescentes.
```tsx
  // ‚úÖ Correto
  className="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8"
  
  // ‚ùå Errado
  className="grid lg:grid-cols-8 md:grid-cols-6 sm:grid-cols-4 grid-cols-2"
```

#### Componentes UI
- **Bot√µes**: altura m√≠nima de 44px (toque confort√°vel).
- **Inputs**: tamanho apropriado para digita√ß√£o mobile (n√£o usar `text-xs` em inputs).
- **Modais**: devem ocupar quase 100% da tela em mobile, centralizar em desktop.
- **Navega√ß√£o**: hamburger menu em mobile, navbar completa em desktop.
- **Touch targets**: m√≠nimo 44x44px para elementos interativos.

#### Textos
- **Hierarquia visual clara**:
  - T√≠tulos: `text-lg sm:text-xl md:text-2xl`
  - Corpo: `text-sm sm:text-base`
  - Legendas: `text-xs`
- **Truncate text** quando necess√°rio: usar `truncate` com `title` attribute para tooltip.

#### Espa√ßamento
- **Padding responsivo**: `p-4 sm:p-6 lg:p-8`
- **Gaps**: adaptar para n√£o ficar muito apertado em mobile: `gap-2 sm:gap-4 lg:gap-6`

### Tailwind CSS

#### Organiza√ß√£o de Classes
```tsx
// ‚úÖ Boa ordem (sugest√£o)
className="
  flex items-center justify-between  // Layout
  px-4 py-2                           // Spacing
  text-sm font-medium                 // Typography
  text-gray-700 dark:text-gray-300    // Colors
  bg-white dark:bg-gray-800           // Background
  border border-gray-200              // Borders
  rounded-lg shadow-sm                // Effects
  hover:bg-gray-50                    // States
  transition-colors                   // Animations
"
```

#### Dark Mode
- **Sempre** adicionar variante dark para cores vis√≠veis:
```tsx
  // ‚úÖ Correto
  className="text-gray-900 dark:text-white"
  
  // ‚ùå Errado (ileg√≠vel em dark mode)
  className="text-gray-900"
```

#### Utilit√°rios Customizados
- Usar `@layer utilities` em `index.css` para anima√ß√µes/estilos reutiliz√°veis.
- Evitar CSS inline ou `<style>` tags.

### Supabase/Backend

#### Queries
- **Sempre** especificar colunas no `.select()` (n√£o usar `*` em produ√ß√£o).
- **Pagina√ß√£o**: usar `.range(from, to)` para datasets grandes.
- **Filtros**: sempre filtrar por `user_id` para seguran√ßa.
- **Ordena√ß√£o**: explicitar `.order()` para consist√™ncia.

#### Tratamento de Erros
```typescript
// ‚úÖ Padr√£o recomendado
try {
  const { data, error } = await supabase.from('table').select('*');
  if (error) throw error;
  return data;
} catch (err) {
  console.error('Context da opera√ß√£o:', err);
  addToast('Mensagem amig√°vel ao usu√°rio', 'error');
  throw err; // Re-throw se o caller precisar tratar
}
```

#### Realtime
- Sempre fazer cleanup de subscriptions em `useEffect` return.
- Usar `isMounted` ref para prevenir updates em componentes desmontados.

### Acessibilidade (A11y)

- **Sem√¢ntica HTML**: usar tags corretas (`<button>`, `<nav>`, `<main>`, etc.).
- **ARIA labels**: adicionar em √≠cones sem texto: `aria-label="Fechar modal"`.
- **Foco**: garantir ordem l√≥gica de tab, estilos vis√≠veis de `:focus`.
- **Contraste**: m√≠nimo WCAG AA (verificar cores em dark mode tamb√©m).
- **Alt text**: sempre em imagens (mesmo que vazio para decorativas).

### Estados de UI

Todo componente que carrega dados deve ter:
1. **Loading**: skeleton ou spinner com texto descritivo
2. **Empty**: estado vazio com ilustra√ß√£o/√≠cone e CTA
3. **Error**: mensagem clara + bot√£o de retry
4. **Success**: dados renderizados
```tsx
// ‚úÖ Exemplo de padr√£o
if (isLoading) return <LoadingState />;
if (error) return <ErrorState onRetry={refetch} />;
if (!data || data.length === 0) return <EmptyState />;
return <DataView data={data} />;
```

## Restri√ß√µes

- **N√ÉO** introduza arquitetura complexa nova (CQRS, event sourcing, etc.) sem solicita√ß√£o expl√≠cita.
- **N√ÉO** adicione depend√™ncias npm sem:
  1. Justificar necessidade
  2. Verificar alternativa nativa/existente
  3. Pedir aprova√ß√£o
- **N√ÉO** altere contratos existentes (rotas/DTOs/schemas/props) sem sinalizar breaking change e pedir aprova√ß√£o.
- **N√ÉO** toque em arquivos fora do escopo da task (minimize blast radius).
- **N√ÉO** use `localStorage` ou `sessionStorage` sem justificativa (preferir Context API ou Supabase).
- **N√ÉO** commit c√≥digo comentado (remova ou documente o motivo).

## Qualidade M√≠nima Esperada

### Valida√ß√£o
- **Client-side**: valida√ß√£o de forms com feedback imediato.
- **Server-side**: valida√ß√µes cr√≠ticas no Supabase (constraints, RLS policies).

### Erros
- **Mensagens padronizadas**:
  - Usu√°rio: claras, acion√°veis, sem jarg√£o t√©cnico
  - Debug: logs com contexto suficiente (sem dados sens√≠veis)
- **Toast notifications**: usar `ToastContext` existente.

### Logs
- Pontos cr√≠ticos: autentica√ß√£o, muta√ß√µes de dados, erros.
- Formato: `console.error('[Contexto]:', erro)`.
- **Nunca** logar: senhas, tokens, dados pessoais sens√≠veis.

### Performance
- **Web Vitals**: atentar para LCP, CLS, FID.
- **Bundle size**: evitar imports desnecess√°rios (tree-shaking).
- **Imagens**: usar formatos modernos (WebP), lazy loading quando apropriado.

## Evid√™ncias Obrigat√≥rias em Toda Entrega

Ao finalizar qualquer implementa√ß√£o, devolva:

### 1. Arquivos Modificados
```
üìù Arquivos Criados/Alterados:
- src/components/EnvelopeBoard.tsx (modificado)
- src/types.ts (adicionado PaginationState)
```

### 2. Resumo de Mudan√ßas
```
üìã Resumo por Arquivo:

src/components/EnvelopeBoard.tsx:
- Adicionado estado de pagina√ß√£o (currentPage, ITEMS_PER_PAGE)
- Implementado ordena√ß√£o dupla (tipo + nome alfab√©tico)
- Criado controles de navega√ß√£o entre p√°ginas
- Atualizado grid para m√°ximo 8 colunas
```

### 3. Comandos Executados
```
üîß Comandos e Resultados:

$ npm install
‚úÖ Sem novas depend√™ncias

$ npm run dev
‚úÖ Servidor rodando em http://localhost:3000
‚úÖ Sem erros de compila√ß√£o

$ npm run lint
‚úÖ 0 errors, 0 warnings

$ npm run build
‚úÖ Build conclu√≠do com sucesso
```

### 4. Checklist de Crit√©rios de Aceite
```
‚úÖ Crit√©rios de Aceite:
- [x] Grid com m√°ximo 8 colunas em desktop
- [x] Pagina√ß√£o funcional com 24 itens por p√°gina
- [x] Ordena√ß√£o: tipo ‚Üí nome alfab√©tico
- [x] Bot√µes anterior/pr√≥xima desabilitados corretamente
- [x] Responsivo em mobile/tablet/desktop
- [x] Drag & drop continua funcionando
- [x] Sem erros de console
```

### 5. Assun√ß√µes
```
ü§î Assun√ß√µes Feitas:
- Considerado que o Drag & Drop s√≥ precisa funcionar dentro da p√°gina atual (n√£o entre p√°ginas)
- Usado s√≠mbolos ‚Üê e ‚Üí para bot√µes de navega√ß√£o (sem depend√™ncia de √≠cones externos)
- Pagina√ß√£o s√≥ aparece quando h√° mais de 24 envelopes
```

### 6. Screenshots (quando aplic√°vel)
- Desktop (lg)
- Tablet (md)
- Mobile (sm)

### 7. Testes Manuais Realizados
```
‚úÖ Testado:
- [x] < 24 envelopes: sem pagina√ß√£o
- [x] Exatamente 24 envelopes: p√°gina 1/1
- [x] 25+ envelopes: pagina√ß√£o correta
- [x] Navega√ß√£o anterior/pr√≥xima
- [x] Ordena√ß√£o alfab√©tica dentro de grupos
- [x] Responsividade em 3 tamanhos de tela
```

## Fluxo de Trabalho Recomendado

1. **Ler** a task completamente
2. **Identificar** arquivos impactados
3. **Verificar** padr√µes existentes nesses arquivos
4. **Implementar** mudan√ßa minimal
5. **Testar** localmente (dev + build)
6. **Documentar** conforme template de evid√™ncias
7. **Revisar** contra este arquivo de rules
8. **Entregar** com evid√™ncias completas

## Quando em D√∫vida

1. Pergunte antes de assumir
2. Prefira o padr√£o existente √† "melhor pr√°tica" gen√©rica
3. Documente a decis√£o em coment√°rio se for n√£o-√≥bvia
4. Menos √© mais: mudan√ßas pequenas e focadas

---

**√öltima atualiza√ß√£o**: 2026-02-01
